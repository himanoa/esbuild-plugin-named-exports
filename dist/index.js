"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("tslib"),r=require("util"),t=e.__importStar(require("enhanced-resolve")),o=e.__importStar(require("cjs-module-lexer")),i=e.__importStar(require("fs")),s=e.__importStar(require("path")),n=(0,r.promisify)(t.create({mainFields:["browser","module","main"]}));let a=!1;function u(r){return e.__awaiter(this,void 0,void 0,(function*(){a||(yield o.init(),a=!0);try{const e=[],t=[];for(t.push(yield n(process.cwd(),r));t.length>0;){const r=t.pop();if(void 0===r)return;const a=o.parse(i.readFileSync(r,"utf8"));e.push(...a.exports);for(const e of a.reexports){const o=yield n(s.dirname(r),e);"string"==typeof o&&t.push(o)}}return e.includes("default")||e.push("default"),e.join(", ")}catch(e){return console.log(e),"default"}}))}const c={name:"cjs-to-esm",setup(r){r.onResolve({filter:/.*/},(e=>{if(""===e.importer)return{path:e.path,namespace:"c2e"}})),r.onLoad({filter:/.*/,namespace:"c2e"},(r=>e.__awaiter(this,void 0,void 0,(function*(){return{contents:`export { ${yield u(r.path)} } from ${JSON.stringify(r.path)}`,resolveDir:process.cwd()}}))))}};exports.default=c;
